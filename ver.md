# 蓝桥本地云网盘 - 版本更新说明

## 版本 v1.0.3 - 局域网访问修复与优化

### 📅 更新日期
2026年01月31日

### 🎯 更新概述
本次更新主要修复了在多网卡环境下（如同时开启 WiFi 和 手机热点）局域网访问地址显示不全或错误的问题。现在程序会自动检测并列出所有可用的 IPv4 局域网地址。

### 🔧 主要修复
#### 1. **多网卡局域网 IP 检测优化**
- **问题**：旧版本仅能检测到单一网卡的 IP，导致在复杂网络环境下用户无法获得正确的访问地址。
- **修复**：
  - 重构了 IP 检测逻辑，使用 `getLocalIPs()` 替换 `getLocalIP`。
  - 程序启动时会遍历所有网络适配器（排除内部回环地址）。
  - 在控制台清晰地列出所有可用的局域网访问 URL 及其对应的网卡名称。

#### 2. **启动日志引导增强**
- **优化**：
  - 增加了防火墙、WiFi 网络环境和 AP 隔离等常见问题的排查提示。
  - 引导用户尝试列表中的所有地址以确保连接成功。

### 📋 修复详情

| 功能模块 | 修复前 | 修复后 |
|---------|--------|--------|
| IP 检测 | 仅显示单一 IP | 显示所有可用局域网 IP |
| 启动提示 | 简单地址显示 | 详细的多地址列表及排错建议 |

---

## 版本 v1.1.0 - 中文文件名支持优化 (历史版本)

### 📅 更新日期
2025年10月24日

### 🎯 更新概述
本次更新主要解决了中文文件名在系统中的乱码问题，完善了中文文件名的编码、存储、显示和搜索功能，确保用户能够正常使用中文文件名进行各种操作。

### 🔧 主要修复
添加密码功能
#### 1. **中文文件名编码处理优化**
- **问题**：中文文件名上传时出现乱码，存储和显示不一致
- **修复**：
  - 服务器端统一使用UTF-8编码进行Base64转换
  - 前端使用正确的UTF-8解码方法处理Base64编码
  - 创建了专用的 `decodeUTF8Base64()` 函数处理中文解码

#### 2. **重命名功能乱码修复**
- **问题**：重命名对话框输入框显示Base64编码而非中文
- **修复**：
  - 改进了 `openRenameModal()` 函数的文件名解析逻辑
  - 支持有扩展名文件和无扩展名文件夹的解码
  - 修复了 `confirmRename()` 函数的比较逻辑

#### 3. **搜索功能中文适配**
- **问题**：搜索功能无法匹配中文文件名
- **修复**：
  - 修改 `filterFiles()` 函数使用显示名称而非原始文件名
  - 搜索现在基于解码后的中文文件名进行匹配

#### 4. **文件夹操作优化**
- **问题**：中文文件夹名在面包屑导航中显示乱码
- **修复**：
  - 更新 `updateBreadcrumb()` 函数使用正确的UTF-8解码
  - 文件夹创建、重命名、显示功能完全支持中文

### 🛠️ 技术改进

#### **新增功能**
```javascript
// UTF-8 Base64解码函数
function decodeUTF8Base64(encodedString) {
    try {
        const binaryString = atob(encodedString);
        const bytes = new Uint8Array(binaryString.length);
        for (let i = 0; i < binaryString.length; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return new TextDecoder('utf-8').decode(bytes);
    } catch (e) {
        return encodedString; // 解码失败，返回原始字符串
    }
}
```

#### **改进的文件名处理逻辑**
- 自动检测文件名是否包含中文字符
- 中文文件名使用Base64编码存储
- 非中文文件名直接存储并添加时间戳
- 显示时自动解码为正确的中文

### 📋 修复详情

| 功能模块 | 修复前 | 修复后 |
|---------|--------|--------|
| 文件上传 | 中文文件名乱码 | 正确编码存储 |
| 文件显示 | Base64编码显示 | 正确解码显示 |
| 文件重命名 | 输入框显示乱码 | 显示正确中文名 |
| 文件搜索 | 无法搜索中文 | 支持中文搜索 |
| 文件夹操作 | 面包屑乱码 | 正确显示中文 |
| 下载功能 | 文件名乱码 | 正确中文文件名 |

### 🎯 用户体验改进

#### **完全支持中文操作**
- ✅ 上传中文文件：`蓝桥.apk` → 正确存储和显示
- ✅ 创建中文文件夹：`我的文档` → 正确创建和显示
- ✅ 重命名操作：输入框显示正确的中文名称
- ✅ 搜索功能：输入中文可以找到对应文件
- ✅ 下载文件：保持原始的中文文件名

#### **兼容性保持**
- ✅ 英文文件名：继续正常工作
- ✅ 特殊字符：正确处理
- ✅ 文件扩展名：保持完整
- ✅ 时间戳：避免文件名冲突

### 🔍 测试验证

#### **测试场景**
1. **文件上传测试**
   - 上传中文文件：`测试文档.pdf`
   - 存储格式：`Base64编码_时间戳.pdf`
   - 显示效果：`测试文档.pdf` ✅

2. **文件夹创建测试**
   - 创建文件夹：`我的文件夹`
   - 存储格式：`Base64编码`
   - 显示效果：`我的文件夹` ✅

3. **搜索功能测试**
   - 搜索关键词：`测试`
   - 匹配结果：包含"测试"的所有文件 ✅

4. **重命名测试**
   - 原文件名：`旧名称.txt`
   - 重命名为：`新名称.txt`
   - 输入框显示：`旧名称.txt`（非乱码）✅

### 📦 打包信息

- **打包工具**：PKG v5.8.1
- **目标平台**：Windows x64
- **Node.js版本**：18
- **文件大小**：约 40.8 MB
- **输出文件**：`LanQiaoCloudDisk.exe`

### 🚀 使用说明

1. **启动程序**：双击 `LanQiaoCloudDisk.exe`
2. **访问地址**：
   - 本地访问：`http://127.0.0.1:2333`
   - 局域网访问：`http://[您的IP]:2333`
3. **功能使用**：
   - 上传中文文件：拖拽或点击上传
   - 创建中文文件夹：点击"新建文件夹"
   - 搜索中文文件：在搜索框输入中文
   - 重命名文件：点击重命名按钮

### ⚠️ 注意事项

1. **文件兼容性**：新版本生成的文件与旧版本完全兼容
2. **数据安全**：所有文件操作都在本地进行，数据不会上传到外部服务器
3. **网络要求**：需要局域网环境，确保设备在同一WiFi网络
4. **防火墙设置**：如无法访问，请检查防火墙是否允许端口2333

### 🔄 版本历史

- **v1.0.0**：基础文件管理功能
- **v1.1.0**：中文文件名支持优化（当前版本）

### 📞 技术支持

如遇到问题，请检查：
1. 程序是否正常启动
2. 端口2333是否被占用
3. 防火墙设置是否正确
4. 网络连接是否正常

---

**蓝桥本地云网盘** - 让文件共享变得简单
